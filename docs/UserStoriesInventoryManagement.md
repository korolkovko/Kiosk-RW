# User Stories: Управление меню, категориями и остатками

## US020: Добавление нового LiveItem

**Описание:**  
Как администратор, я хочу добавить новый товар LiveItem в активное меню,  
чтобы покупатели могли видеть и заказывать его через систему.

**Начальное состояние:**  
- Администратор авторизован  
- В справочниках уже заведены UnitOfMeasure, FoodCategory, DayCategory

**Выходное состояние:**  
- Создана запись в LiveItem  
- Инициализирована запись в ItemLiveAvailable  
- Поле CreatedBy связано с UserID  
- Товар доступен для заказа

**Используемые сущности:**  
- LiveItem  
- ItemLiveAvailable  
- UnitOfMeasure  
- FoodCategory  
- DayCategory  
- User  

**Технические примечания:**  
- ENUM: поля UnitOfMeasure, FoodCategory, DayCategory выбираются из справочников  
- Snapshot в ItemLiveAvailable: единица измерения  
- CreatedBy и CreatedAt фиксируются  
- Цена: рассчитываются ItemVatAmount и ItemPriceGross  
- IsActive = true по умолчанию

---

## US021: Перенос LiveItem в архив (ItemArchive)
ДЕЛАЕМ ТОЛЬКО ПОСЛЕ РЕАЛИЗАЦИИ ФУНЦКИОНАЛА ОБРАБОТКИ ЗАКАЗА/КОРЗИНЫ!!!

**Описание:**  
Как администратор, я хочу перенести товар в архив,  
чтобы исключить его из продаж, но сохранить историю.

**Начальное состояние:**  
- Существующий активный LiveItem  
- Товар не участвует в незавершённых заказах

**Выходное состояние:**  
- Запись в ItemArchive (snapshot всех полей)  
- LiveItem удалён или IsActive = false  
- Связанные ItemLiveAvailable — каскадное удаление  
- CreatedBy и CreatedAt зафиксированы

**Используемые сущности:**  
- LiveItem  
- ItemArchive  
- ItemLiveAvailable  
- User  

**Технические примечания:**  
- Snapshot всех значений из LiveItem  
- ENUM-поля хранятся как строки  
- ReservedQuantity в остатках должен быть нулевым  
- Проверка на активные заказы — вне рамок этой истории

---

## US022: Добавление новой единицы измерения (UnitOfMeasure)

**Описание:**  
Как администратор, я хочу добавить новую единицу измерения,  
чтобы её можно было выбрать при создании товара.

**Начальное состояние:**  
- Администратор авторизован  
- Названия на RU/EN уникальны

**Выходное состояние:**  
- Добавлена запись в UnitOfMeasure  
- Значения доступны в выборе при добавлении LiveItem

**Используемые сущности:**  
- UnitOfMeasure  
- User  

**Технические примечания:**  
- Валидация уникальности NameOfMeasurementUnitRu/Eng  
- ChangeAt и ChangeBy фиксируются  
- Используется в ENUM-полях LiveItem.UnitOfMeasureRu/Eng

---

## US023: Добавление новой категории (FoodCategory / DayCategory)

**Описание:**  
Как администратор, я хочу добавить новую категорию еды или времени дня,  
чтобы её можно было назначать товарам при создании или обновлении.

**Начальное состояние:**  
- Администратор авторизован  
- Подготовлено имя категории  
- Для DayCategory — указаны StartAt и EndsAt (формат HHMMSS)

**Выходное состояние:**  
- Создана запись в нужной таблице (FoodCategory или DayCategory)  
- Категория отображается в выпадающем списке при редактировании товара  
- Для DayCategory: интервалы не пересекаются с существующими

**Используемые сущности:**  
- FoodCategory  
- DayCategory  
- User  

**Технические примечания:**  
- ChangeAt и ChangeBy фиксируются  
- ENUM-значения в LiveItem (DayCategory, FoodCategory)  
- Snapshot этих значений сохраняется в ItemArchive при архивировании

---

## US024: Пополнение товарных остатков (ItemLiveAvailable + журнал)

**Описание:**  
Как администратор, я хочу пополнить запас по товару,  
чтобы отразить поступление и сделать товар доступным для заказа.

**Начальное состояние:**  
- Существующий активный товар (LiveItem)  
- Запись в ItemLiveAvailable существует  
- Известно количество к пополнению (положительное)

**Выходное состояние:**  
- StockLiveQuantity увеличен  
- ReservedQuantity не изменяется  
- Создана запись в ItemLiveStockReplenishment с snapshot’ами  
- Зафиксированы ChangeAt и ChangeBy

**Используемые сущности:**  
- LiveItem  
- ItemLiveAvailable  
- ItemLiveStockReplenishment  
- User  

**Технические примечания:**  
- Валидация: ChangeQuantity > 0  
- Атомарное обновление StockLiveQuantity  
- Snapshot: Name, Description, UnitOfMeasure  
- История пополнений пригодна для аудита